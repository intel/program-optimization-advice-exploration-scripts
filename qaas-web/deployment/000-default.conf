#apache config for multiple react project hosting
WSGIDaemonProcess ovbackend user=www-data group=www-data threads=5
WSGIDaemonProcess qaasbackend user=www-data group=www-data threads=5
WSGIDaemonProcess lorebackend user=www-data group=www-data threads=5

WSGIScriptAlias /oneview/api /var/www/html/oneview/backend/server.wsgi
WSGIScriptAlias /qaas/api /var/www/html/qaas/backend/server.wsgi
WSGIScriptAlias /lore/api /var/www/html/lore/backend/server.wsgi


<VirtualHost *:80>
    ServerName localhost
    DocumentRoot /var/www/html
    #redirect if certificate file exist
    <IfFile "/etc/letsencrypt/live/qaas_ov_lore_landing_certificate/fullchain.pem" >
        RewriteEngine on
        RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
    </IfFile>

    Alias /landing_page "/var/www/html/landing/dist"
    <Directory /var/www/html/landing/dist>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        FallbackResource /landing/dist/index.html
    </Directory>

    Alias /oneview_page "/var/www/html/oneview/dist"
    <Directory /var/www/html/oneview/dist>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        FallbackResource /oneview/dist/index.html
    </Directory>

    <Directory /var/www/html/oneview/backend>
        WSGIProcessGroup ovbackend
        WSGIApplicationGroup %{GLOBAL}
        Require all granted
    </Directory>

    #otter generated html settings
    Alias /otter_html /var/www/html/private/otter_html
    <Directory /var/www/html/private/otter_html>
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>


    # Alias for qaas project
    Alias /qaas_page "/var/www/html/qaas/dist"
    <Directory "/var/www/html/qaas/dist">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        FallbackResource /qaas/dist/index.html
    </Directory>

    #  qaas  backend setup
    <Directory "/var/www/html/qaas/backend">
        WSGIProcessGroup qaasbackend
        WSGIApplicationGroup %{GLOBAL}
        Require all granted
    </Directory>

    # Alias for lore project
    Alias /lore_page "/var/www/html/lore/dist"
    <Directory "/var/www/html/lore/dist">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        FallbackResource /lore/dist/index.html
    </Directory>

    #  lore  backend setup
    <Directory "/var/www/html/lore/backend">
        WSGIProcessGroup lorebackend
        WSGIApplicationGroup %{GLOBAL}
        Require all granted
    </Directory>



    ErrorLog /var/log/apache2/error.log
    CustomLog /var/log/apache2/access.log combined


</VirtualHost>



<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName localhost
    DocumentRoot /var/www/html

    Alias /landing_page "/var/www/html/landing/dist"
    <Directory /var/www/html/landing/dist>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        FallbackResource /landing/dist/index.html
    </Directory>

    Alias /oneview_page "/var/www/html/oneview/dist"
    <Directory /var/www/html/oneview/dist>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        FallbackResource /oneview/dist/index.html
    </Directory>

    <Directory /var/www/html/oneview/backend>
        WSGIProcessGroup ovbackend
        WSGIApplicationGroup %{GLOBAL}
        Require all granted
    </Directory>

    #otter generated html settings
    Alias /otter_html /var/www/html/private/otter_html
    <Directory /var/www/html/private/otter_html>
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>


    # Alias for qaas project
    Alias /qaas_page "/var/www/html/qaas/dist"
    <Directory "/var/www/html/qaas/dist">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        FallbackResource /qaas/dist/index.html
    </Directory>

    #  qaas  backend setup
    <Directory "/var/www/html/qaas/backend">
        WSGIProcessGroup qaasbackend
        WSGIApplicationGroup %{GLOBAL}
        Require all granted
    </Directory>

    # Alias for lore project
    Alias /lore_page "/var/www/html/lore/dist"
    <Directory "/var/www/html/lore/dist">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        FallbackResource /lore/dist/index.html
    </Directory>

    #  lore  backend setup
    <Directory "/var/www/html/lore/backend">
        WSGIProcessGroup lorebackend
        WSGIApplicationGroup %{GLOBAL}
        Require all granted
    </Directory>



    ErrorLog /var/log/apache2/error.log
    CustomLog /var/log/apache2/access.log combined


Include /etc/letsencrypt/options-ssl-apache.conf
SSLCertificateFile /etc/letsencrypt/live/qaas_ov_lore_landing_certificate/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/qaas_ov_lore_landing_certificate/privkey.pem
</VirtualHost>
</IfModule>